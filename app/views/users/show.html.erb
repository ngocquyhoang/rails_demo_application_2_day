<% provide(:title, "#{@user.name} Blogger") %>
<div class="container">
  <div class="section">
    <div class="row">
      <div class="col s12 m3 l4">
        <div class="col s10 offset-s1 m8 offset-m2 l8 offset-l2">
          <%= gravatar_large_for @user %>
        </div>
          <% if  user_signed_in? && @user == current_user %>
            <%= render "dashboard_control" %>
          <% end %>
      </div>
      <div class="col m9 l8">
        <table class="bordered">
          <tbody>
            <thead>
              <tr>
                  <th colspan="2" class="center flow-text"><%= @user.name %> 's Profile
                    <% if  user_signed_in? && @user == current_user %>
                      <%= render "user_detail_control" %>
                    <% end %>
                  </th>
              </tr>
            </thead>
            <tr>
              <td>Name</td>
              <td class="right-align"><%= @user.name %></td>
            </tr>
            <tr>
              <td>Email</td>
              <td class="right-align"><%= @user.email %></td>
            </tr>
            <tr>
              <td>Address</td>
              <td class="right-align" id="user_address"><%= @user.address %></td>
            </tr>
            <tr>
              <td>Phone</td>
              <td class="right-align" id="user_phone"><%= @user.phone %></td>
            </tr>
            <tr>
              <td>Blog</td>
              <td class="right-align"><%= @user.posts.count %></td>
            </tr>
            <tr>
              <td>Follower</td>
              <td class="right-align"><%= @user.followers.count %></td>
            </tr>
            <tr>
              <td>Following</td>
              <td class="right-align"><%= @user.following.count %></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <p class="center flow-text">Latest Blog of <%= @user.name %>
  <% if  user_signed_in? && @user != current_user %>
    <a class="btn-floating waves-effect waves-light btn-large <%= random_color %> right tooltipped" data-position="bottom" data-delay="0" data-tooltip="Follow <%= @user.name %>" data-follow="<%= current_user.following?(@user) ? 'true' : 'false' %>" id="follow_user"><i class="large material-icons left">favorite</i>button</a>
  <% end %>
  </p>
  <div class="divider"></div>
  <div class="section">
    <div class="row">
      <% if @user.posts.present? %>
        <% @user.posts.last(3).reverse.each do |last_post| %>
          <div class="col s12 m4 l4">
            <div class="card blue-grey darken-1">
              <div class="card-content white-text">
                <span class="card-title"><%= truncate(strip_tags(last_post.title), :length => 25 ) %></span>
                <p><%= truncate(strip_tags(last_post.content), :length => 80 )%></p>
              </div>
              <div class="card-action">
                <%= link_to "Read more", last_post %>
              </div>
            </div>
          </div>
        <% end %>
      <% else %>
        <h2 class="flow-text center">Now <%= user_signed_in? && @user != current_user ? @user.name : "you" %> don't have a Blog <% if this_user(@user) %><%= link_to "Make it now", new_post_path %><% end %></h2>
      <% end %>
    </div>
  </div>
</div>
<% if  user_signed_in? %>
  <% if @user == current_user %>
    <%= render "user_detail" %>
    <%= render "dashboard" %>
  <% else %>
    <script type="text/javascript">
      $('#follow_user').click(function(event) {
        var status_fl = $(this).attr('data-follow');
        $.ajax({
          url: '/follow',
          type: 'POST',
          data: {status_fl: status_fl, user_id: <%= @user.id  %>},
          success: function(data) {
            if (data["status"] == "success") {
              if($('#follow_user').attr('data-follow') == "true"){
                $('#follow_user').attr('data-follow', 'false');
                Materialize.toast('You are unfollow <%= @user.name%>' , 4000,'rounded');
              }else{
                $('#follow_user').attr('data-follow', 'true');
                Materialize.toast('You are following <%= @user.name%>' , 4000,'rounded');
              };
            }else{
              Materialize.toast('Error please reload page !', 4000,'rounded');
            }
          }
        });
      });
    </script>
  <% end %>
<% else %>
  <script type="text/javascript">
    $('#follow_user').click(function() {
      Materialize.toast('Please sign in !', 4000,'rounded');
    });
  </script>
<% end %>